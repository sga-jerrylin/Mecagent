# 技术架构设计（PDF/图到“装配规范 + 3D 爆炸动画”）

下面是可直接交给 Augment（vibe-coding）实施的**端到端方案**。分三大块：

1. **主模型（汇总推理）提示词**；
2. **装配图理解子系统（PDF→候选事实）**；
3. **3D 处理子系统（STL→GLB + 爆炸动画）**。
   配套提供：数据契约（统一 JSON）、接口设计、最小可跑脚本思路与质量/运维指标。

---

## 0. 总体架构与数据流

**双通道识别 → 中间数据契约 → 主模型融合 → 装配规范 JSON → 3D 动画联动**

```
[PDF] ─┬─► [视觉通道(Image OCR/符号/尺寸/图元)]
       └─► [文本通道(PyPDF/Camelot 表格/技术要求)]
             │
             ▼
     [候选事实 JSON（统一契约）]
             │
             ▼
     [主模型：融合与推理（本节1）]
             │
   ┌─────────┴──────────┐
   ▼                      ▼
[装配规范 JSON]       [分件映射 manifest.json]
                           │
                  [STL → 分件/接触图 → GLB/动画（本节3）]
                           │
                           ▼
                   [Web 前端 three.js/<model-viewer> 联动]
```

**统一数据契约**是关键：视觉/文本两路先各自产出“候选事实”，主模型只做**融合、推理与计划**，降低幻觉与不稳定。

---

## 1) 主模型（汇总推理）提示词

### 1.1 System Prompt（可直接粘贴）

> 你是“机械装配与工艺规划汇总器”。
> **输入**是一份来自“视觉通道/文本通道”的**候选事实 JSON**（已包含 BOM 行、技术要求、尺寸/孔距、焊接/形位符号、视图和表格的证据定位）。
> **你的任务**：
>
> 1. **实体归并与冲突调解**：同一字段存在多候选时，按来源权重（BOM 表>技术要求文本>视觉识别）与一致性选择“主事实”，其余保留在 `alternatives`。
> 2. **构建部件层级与连接关系**：输出 `parts[]`、`connections[]`（焊/螺/过盈/定位）。
> 3. **生成装配计划**：`assembly_plan.sequence[]` 给出**可执行工艺动作**（定位/点焊/全焊/矫形/打磨/喷涂/紧固）与**检验点**。
> 4. **质检计划与风险**：`qc_plan` 写明关键尺寸/焊缝抽检与方法；`risks` 标出热变形/喷涂遮蔽等。
> 5. **溯源与置信度**：每条结论**必须**包含 `evidence{page_id, region或row_id}` 与 `confidence(0~1)`。
> 6. **严禁臆造**：缺失数据写入 `unknowns` 与 `questions_to_ask`；不得自造标准/扭矩/膜厚。
> 7. **严格遵守输出 Schema**，先输出 JSON，随后用不超过 10 行中文给出要点摘要。

**来源权重建议**：BOM表 0.9 > 技术要求 0.8 > 视觉图像 0.7；多来源一致+0.1；跨视图互证+0.05；异常降权（乱码、单位异常、几何冲突）。

### 1.2 输出 Schema（装配规范 JSON，给下游统一用）

```json
{
  "doc_meta": {
    "drawing_no": "string?",
    "rev": "string?",
    "pages": [{"page_id": 1, "note": "主装配图"}]
  },
  "extracted": {
    "tech_requirements": [
      {"text":"...","evidence":{"page_id":1,"region":[x,y,w,h]},"confidence":0.9}
    ],
    "bom_table": [
      {
        "seq": 9, "code": "T-XXXX", "name": "加强筋",
        "material":"Q355B","qty":2,"unit":"件","weight_each":0.60,
        "evidence":{"page_id":1,"table_row":9},"confidence":0.95
      }
    ]
  },
  "parts": [
    {
      "part_id":"P-LEFT_BRACKET","bom_code":"T-EURO-00",
      "name":"左挂件组件","category":"焊接件","material":"Q355B",
      "features":[{"type":"plate","thickness":6},{"type":"hole","dia":15,"qty":8}],
      "views_refs":[{"page_id":1,"view":"等轴测","note":"编号5"}],
      "confidence":0.88
    }
  ],
  "connections": [
    {
      "type":"weld",
      "between":["P-LEFT_BRACKET","P-MAIN_PLATE"],
      "spec":{"weld_size":"8","continuous":true},
      "sequence_hint":"点焊→对称全焊→打磨",
      "evidence":{"page_id":1,"region":[...]},
      "confidence":0.83
    },
    {
      "type":"fastener",
      "between":["P-MAIN_PLATE","P-ADAPTER"],
      "fastener":{"standard":"M12","grade":"8.8","qty":8,"torque_Nm":"unknown"},
      "evidence":{"page_id":1,"region":[...]},
      "confidence":0.72
    }
  ],
  "assembly_plan": {
    "sequence": [
      {
        "step":1,"id":"STEP-001",
        "action":"装夹定位基准件",
        "targets":["P-MAIN_PLATE"],
        "checks":["基准边对中±0.5"],
        "evidence":{"page_id":1}, "confidence":0.9
      },
      {
        "step":2,"id":"STEP-002",
        "action":"安装左右挂件并点焊定位",
        "targets":["P-LEFT_BRACKET","P-RIGHT_BRACKET"],
        "resources":["角尺","点焊钳"],
        "checks":["对称度≤1.0"], "confidence":0.85
      }
    ],
    "fixtures":["V形定位块","90°角靠"],
    "safety_notes":["对称分段焊，控制变形"]
  },
  "qc_plan": {
    "kpcs":[
      {"item":"孔距170/283","method":"卡尺/检具","tolerance":"见图","evidence":{"page_id":1}, "confidence":0.9}
    ],
    "ndt":[{"area":"主承载焊缝","method":"PT/VT","ratio":"抽检"}]
  },
  "risks":[
    {"risk":"焊接热变形导致孔距偏差","mitigation":"对称分段焊+工装限位"}
  ],
  "unknowns":[
    {"field":"螺栓扭矩","reason":"图纸未给出","suggestion":"按8.8级默认或向设计确认"}
  ],
  "questions_to_ask":[
    "喷涂色号与膜厚标准？","未注公差执行规范编号？"
  ],
  "traceability":[
    {"claim":"焊脚8","evidence":{"page_id":1,"region":[...]}}
  ]
}
```

---

## 2) 装配图理解子系统（PDF→候选事实 JSON）

### 2.1 模块拆分

* **pdf2images**：每页 300–400 DPI PNG；
* **版面切块**：检测 `titleblock / tech_requirements / bom / main_view / iso_view / detail_view[*]`；
* **视觉通道**：区域 OCR + 符号分类（焊接符号、形位公差、孔径/孔距、编号气泡、箭头/引出线）；
* **文本通道**：PyPDF 文本；Camelot/Tabula 解析 BOM 表，字段规整；
* **候选归一**：把两路结果写入**候选事实 JSON**（如下）。

### 2.2 候选事实 JSON（主模型输入契约）

```json
{
  "pages":[{"page_id":1,"width_px":4960,"height_px":3508}],
  "regions":[
    {"page_id":1,"type":"bom","bbox":[x,y,w,h]},
    {"page_id":1,"type":"tech_requirements","bbox":[x,y,w,h]},
    {"page_id":1,"type":"main_view","bbox":[x,y,w,h]},
    {"page_id":1,"type":"iso_view","bbox":[x,y,w,h]}
  ],
  "bom_candidates":[
    {
      "source":"camelot","row_id":9,
      "seq":"9","code":"CS-ST1070...Q355B","name":"加强筋",
      "material":"Q355B","qty":"2","unit":"件","weight_each":"0.60",
      "evidence":{"page_id":1,"table_row":9}
    }
  ],
  "feature_candidates":[
    {"type":"weld_symbol","value":{"leg":"8","continuous":true},"source":"vision",
     "evidence":{"page_id":1,"region":[...]}},
    {"type":"dimension","value":{"kind":"pattern_hole","distances":[100,170,283]},
     "source":"vision","evidence":{"page_id":1,"region":[...]}}
  ],
  "note_candidates":[
    {"text":"未注尺寸公差按T/1184-k","source":"vision",
     "evidence":{"page_id":1,"region":[...]}}
  ]
}
```

### 2.3 关键算法要点

* **符号分类**：训练/微调或用规则+模板匹配（焊接符号、∥、⊥、Φ、⌀、R、槽焊符号等）。
* **尺寸解析**：提取“数字+引出线+箭头”组合，构建尺寸实体；孔列（100/170/283）归并为 pattern。
* **视图对齐**：同一编号气泡（1/2/5/7/9…）在等轴测与主视图的零件对应。
* **BOM 规整**：列名鲁棒映射（`["序号","code","代号"]` 等），单位/小数位统一；`code+material+thickness` 作合并键。
* **证据坐标**：所有文本/符号/表格行列保留 `region` 或 `table_row`，用于前端高亮与审校。

### 2.4 服务接口（OpenAPI 片段）

```yaml
post /parse-pdf:
  summary: PDF→候选事实 JSON
  requestBody: { application/pdf }
  responses:
    200:
      application/json:
        schema: { $ref: '#/components/schemas/CandidateFacts' }

post /fuse-facts:
  summary: 候选事实→装配规范 JSON（调用主模型）
  requestBody: { application/json: CandidateFacts }
  responses:
    200: { application/json: AssemblySpec }
```

---

## 3) 3D 处理子系统（STL→GLB + 爆炸动画）

### 3.1 流水线

1. **导入与清洗**

   * `trimesh`/Blender：修法线、填洞、去重顶点、**单位统一 mm**、居中/对齐主轴。
2. **分件**

   * **连通域分割**（watertight 可选）；
   * **接触/粘连判断**：面间距阈值、法线夹角、接触面积；
   * **规则切割**（平面切分）增强钣金焊接件可分性；
   * 得到 `part_uid` 列表（若能匹配到 BOM `code` 更佳）。
3. **接触图/层级**

   * 计算零件-零件**相邻/接触**图（距离/包围盒/三角面接触）；
   * 结合 `assembly_plan.sequence` 推出层级与爆炸顺序。
4. **导出 GLB(glTF2.0)**

   * 每个 `part_uid` 一个 Node；写入 `extras:{part_id,bom_code}`；
   * Draco/meshopt 压缩。
5. **爆炸动画**

   * 为每个步骤 `STEP-XXX` 生成动画片段（或一个长动画带关键帧）；
   * **偏移向量策略**：

     * 基准件不动；子件取**最短分离向量**或**从装配基准的法向**；
     * 多层分段：t0 原位 → t1 1/3 → t2 2/3 → t3 全展开。
6. **manifest.json（3D联动契约）**

   * 用于前端把“装配规范 JSON 的 `part_id/step` ↔ GLB 节点/动画”对齐。

**manifest.json 模板**

```json
{
  "model": "assembly.glb",
  "node_map": { "P-LEFT_BRACKET": "node_12", "P-RIGHT_BRACKET": "node_13" },
  "steps": [
    {"id":"STEP-001","parts":["P-MAIN_PLATE"],"action":"装夹定位"},
    {"id":"STEP-002","parts":["P-LEFT_BRACKET","P-RIGHT_BRACKET"],"action":"点焊定位"}
  ],
  "colors": { "Q355B": "#9aa7b0", "SUS304": "#cfd3d6" },
  "evidence_links": [
    {"part":"P-LEFT_BRACKET","page_id":1,"region":[...]}
  ]
}
```

### 3.2 后端脚本骨架（思路）

**分件 + 导出（Python/trimesh + Blender CLI）**

```python
# split_stl.py  (伪代码)
import trimesh, json, os
m = trimesh.load("input.stl", process=True)
m.apply_scale(1000.0)  # m->mm 视情况
components = m.split(only_watertight=False)

parts_dir = "out_parts"
os.makedirs(parts_dir, exist_ok=True)
mapping = {}
for i, comp in enumerate(components):
    comp.remove_unreferenced_vertices()
    comp.export(f"{parts_dir}/part_{i:03d}.stl")
    mapping[f"P-{i:03d}"] = f"part_{i:03d}.stl"

json.dump({"parts": mapping}, open("parts_manifest.json","w"))
```

**组装 + 动画（Blender 无头）**

```bash
blender -b -P build_glb.py -- \
  --parts_manifest parts_manifest.json \
  --assembly_spec assembly_spec.json \
  --out assembly.glb
```

`build_glb.py` 关键步骤：

* 导入所有 STL → 每个对象写 `["part_id","bom_code"]` custom props（导出为 glTF `extras`）；
* 根据 `assembly_spec.assembly_plan.sequence` 生成 `STEP-XXX` 动画（location 关键帧）；
* 导出 GLB（启用 Draco/meshopt）。

### 3.3 前端联动

* three.js 或 `<model-viewer>`：

  * 加载 `assembly.glb` 与 `manifest.json` + `assembly_spec.json`；
  * 点击“STEP-002”→ 播放对应动画片段，聚焦 `node_map` 的节点，高亮/剖切；
  * 侧栏显示 2D 证据（`page_id/region`）截图或高亮框，支持一键跳转。

---

## 4) 目录结构与接口

```
/app
  /api
    parse_pdf.py            # PDF→候选事实
    fuse_facts.py           # 候选事实→装配规范(JSON)（主模型）
    stl_split.py            # STL 分件
    build_glb.py            # Blender 组装/动画导出
  /schemas
    candidate_facts.schema.json
    assembly_spec.schema.json
    manifest.schema.json
  /web
    viewer.html             # ThreeJS/<model-viewer> 播放器
  /tests
    sample.pdf
    sample.stl
```

**关键 REST/任务队列**

* `POST /parse-pdf` → `CandidateFacts`
* `POST /fuse-facts` → `AssemblySpec`
* `POST /stl-to-glb`（含分件/动画构建）→ `{ glb_url, manifest_url }`
* 任务型建议用 `Celery/RQ`，前端轮询 `GET /task/{id}`。

---

## 5) 质量与运维指标

* **字段召回**：BOM 行召回率、技术要求条目召回、关键尺寸召回。
* **一致性**：`AssemblySpec` 通过 Schema 校验率；`node_map` 命中率。
* **可追溯**：traceability 高亮可回看比例。
* **人工复核时长**：单图平均校对时间。
* **3D 性能**：GLB 体积、首屏加载时长、动画帧率。

---

## 6) 常见风险与兜底

* **STL 一体化严重**：连通域不分 → 启用“平面切割 + 接触面积阈值”；开放前端“一刀两断”交互。
* **BOM/视图冲突**：数量/材料不一致 → `unknowns` + `questions_to_ask`，不得硬合。
* **单位混乱**：PDF 标注 mm、STL 实为 m → 在 `doc_meta` 标明单位推断与换算记录。
* **动画错位**：GLB 节点与 `part_id` 不匹配 → 以 `manifest.node_map` 为唯一真相，提供一键重映射 UI。

---

### 结语

这套设计把**识别**与**推理**解耦，用**统一 JSON 契约**把 PDF 与 3D 两侧打通；主模型专注于“融合+计划”，3D 子系统专注于“分件+动画”。你用 Augment 拉起脚手架时，照着以上 **Schema、接口、脚本骨架** 落就行。需要我把 `candidate_facts.schema.json / assembly_spec.schema.json / manifest.schema.json` 三份正式 JSON Schema 也写出来吗？我可以直接给到可校验版本。
太好了——把“PDF 视觉通道”单独做成**阿里系视觉大模型底座智能体**非常合适。我给你一套可直接落地的**系统提示词（System Prompt）**，外加**输入/输出契约、标签集、判定与后处理规则、稳健性约束**。把它塞进该模型的 system，就能稳定产出供主模型融合的“候选事实 JSON”。

---

# 一、阿里视觉模型 · 系统提示词（System Prompt）

> 你是“工程图视觉解析智能体”。你的职责是：从输入的**工程图页面图像**中，精准抽取用于装配/工艺规划的**候选事实**，并输出**结构化 JSON**。
> 你只做**视觉与版面理解**：区域定位、文字/OCR、尺寸和符号识别、BOM 表解析、编号气泡与零件对应、视图类型判定。**不要做装配顺序或工艺推理**。
>
> **必须遵守：**
>
> 1. **可追溯**：每个结论提供 `evidence`（`page_id`、`region[x,y,w,h]` 或 `table_row`）。
> 2. **不臆造**：看不清或不确定的值用 `"unknown"`，并在 `confidence` 降低。
> 3. **规范输出**：严格按“候选事实 JSON 契约”输出（见本提示词末尾），不要输出多余文本。
> 4. **鲁棒 OCR**：修正常见 OCR 错误（例如 “Ø/Φ/⌀/O/0” 混淆，“—/–/-” 连字符，“×/x” 乘号等），保留原文于 `raw` 字段。
> 5. **符号优先**：优先识别**焊接符号、形位公差、粗糙度、倒角、板厚、孔径/孔距**等工程要素。
> 6. **区域分块**：先判定并输出页面区域（`titleblock/tech_requirements/bom/main_view/iso_view/detail_view[*]`），再在各区域内识别要素。
> 7. **单位与数值**：默认 mm；发现其它单位必须记录在 `notes`。数值保留 2 位小数。
> 8. **中文为主**：保留技术要求原文（中文优先），同时给出标准化字段。
>
> **识别任务清单：**
>
> * **页面区域**：标题栏、技术要求、BOM 表、主视图、等轴测、局部/剖视。
> * **BOM 表**：序号、代号/编码、名称、材料/牌号、规格、数量、单位、单重/总重。
> * **几何/尺寸**：线性尺寸、孔径（Φ）、孔列/阵列（如 `100/170/283`）、板厚( t )、倒角 C/R。
> * **符号**：焊接（焊脚δ、连续/间断、单/双面、角/坡口符号）、形位公差（⏊ ⏥ ⌖ ⌯ 等）、粗糙度。
> * **编号气泡与零件轮廓**：在等轴测/主视图中定位零件编号气泡与对应区域。
> * **技术要求**：逐条抽取（如“未注尺寸公差按…规范”“焊接顺序/焊脚/清根/去毛刺/涂装/热处理”）。
>
> **置信度策略：** OCR 文本 0.6 起步；符号+文字组合 0.75；视图跨证或与表格互证 +0.1；存在涂抹/遮挡 -0.2。
>
> **输出**：仅输出**候选事实 JSON**（见契约），禁止其它内容。

---

# 二、输入/输出契约

## 1) 输入（模型的 content 或 tool 参数）

```json
{
  "page_id": 1,
  "image_hint": "PNG 300-400DPI",
  "page_pixels": {"width": 4960, "height": 3508},
  "options": {
    "need_layout_blocks": true,
    "need_symbols": true,
    "language": "zh"
  }
}
```

## 2) 输出：候选事实 JSON（供主模型融合）

```json
{
  "pages":[{"page_id":1,"width_px":4960,"height_px":3508}],
  "regions":[
    {"page_id":1,"type":"titleblock","bbox":[x,y,w,h],"confidence":0.95},
    {"page_id":1,"type":"tech_requirements","bbox":[x,y,w,h],"confidence":0.94},
    {"page_id":1,"type":"bom","bbox":[x,y,w,h],"confidence":0.96},
    {"page_id":1,"type":"main_view","bbox":[x,y,w,h],"confidence":0.92},
    {"page_id":1,"type":"iso_view","bbox":[x,y,w,h],"confidence":0.90},
    {"page_id":1,"type":"detail_view","label":"A","bbox":[x,y,w,h],"confidence":0.88}
  ],
  "bom_candidates":[
    {
      "source":"vision",
      "row_id":9,
      "seq":"9",
      "code":"CS-ST1070(42N)-MP9-10LDY-10D0-01-03-Q355B",
      "name":"加强筋",
      "material":"Q355B",
      "spec":"t=6",
      "qty":"2",
      "unit":"件",
      "weight_each":"0.60",
      "raw_row_text":"...",
      "evidence":{"page_id":1,"table_row":9,"region":[x,y,w,h]},
      "confidence":0.95
    }
  ],
  "feature_candidates":[
    {
      "type":"dimension",
      "value":{"kind":"linear","val":790.5,"unit":"mm","tol":"unknown"},
      "context":{"view":"main_view"},
      "raw":"790.5",
      "evidence":{"page_id":1,"region":[x,y,w,h]},
      "confidence":0.86
    },
    {
      "type":"pattern_hole",
      "value":{"distances":[100,170,283],"count":"unknown"},
      "context":{"view":"side_detail"},
      "raw":"100 / 170 / 283",
      "evidence":{"page_id":1,"region":[x,y,w,h]},
      "confidence":0.84
    },
    {
      "type":"plate_thickness",
      "value":{"t":6.00,"unit":"mm"},
      "context":{"view":"main_view"},
      "raw":"t6",
      "evidence":{"page_id":1,"region":[x,y,w,h]},
      "confidence":0.8
    },
    {
      "type":"weld_symbol",
      "value":{"leg":8.0,"continuous":true,"double_side":false,"type":"fillet"},
      "context":{"view":"side_detail"},
      "raw":"δ8（连续）",
      "evidence":{"page_id":1,"region":[x,y,w,h]},
      "confidence":0.85
    },
    {
      "type":"gdnt",
      "value":{"symbol":"perpendicularity","tolerance":"0.1","datums":["A"]},
      "context":{"view":"detail_view A"},
      "raw":"⏊ 0.1 A",
      "evidence":{"page_id":1,"region":[x,y,w,h]},
      "confidence":0.78
    }
  ],
  "note_candidates":[
    {
      "text":"未注尺寸公差按 T/1184-k 执行；焊缝清根打磨；喷涂前去毛刺除锈。",
      "raw_lines":["...","..."],
      "evidence":{"page_id":1,"region":[x,y,w,h]},
      "confidence":0.9
    }
  ],
  "part_bubble_candidates":[
    {
      "label":"5",
      "region":{"page_id":1,"bbox":[x,y,w,h]},
      "link_view":"iso_view",
      "nearby_shape_bbox":[x2,y2,w2,h2],
      "confidence":0.82
    }
  ],
  "units_notes":[{"scope":"page","unit":"mm","confidence":0.95}],
  "warnings":[
    "BOM 第7行可能与视图标注材料不一致",
    "发现疑似单位冲突：膜厚 μm"
  ]
}
```

---

# 三、识别标签与规则（给模型明确“看什么、怎么判”）

## 1) 区域（layout）

* `titleblock`、`tech_requirements`、`bom`、`main_view`、`iso_view`、`detail_view(label)`、`side_view/section`。

## 2) 工程要素

* **尺寸**：`linear`、`diameter(Φ)`、`radius(R)`、`pattern_hole(多段距)`、`thickness(t)`、`chamfer(C/R)`。
* **符号**：`weld_symbol{fillet,groove,spot,stitch; leg; pitch; side; continuous}`、`gdnt{flatness,perpendicularity,parallelism,position,concentricity,...}`、`roughness(Ra)`。
* **编号气泡**：圆圈数字 + 轮廓区域（零件近似框/多边形）。
* **BOM 字段**：`seq, code, name, material, spec, qty, unit, weight_each/total`。

## 3) 解析准则

* **孔列/阵列**：把“`100 170 283`”解析为 `pattern_hole.distances=[100,170,283]`。
* **焊接**：识别**连/断焊**、**单/双面**、**角/坡口**，将焊脚厚度写入 `leg`，间断节距写 `pitch`。
* **形位公差**：输出 `symbol`（统一英文枚举）+ `tolerance` + `datums`。
* **材料与板厚**：材料进 `material`，板厚进 `plate_thickness`；若 BOM 与视图冲突，写入 `warnings`。

---

# 四、稳健性与后处理（模型内指令+外部脚本都可用）

* **OCR 归一**：

  * `Ø/Φ/⌀/O/0` 归一为 `Φ`；`×` 归一为 `x`；中文全角/半角统一。
  * 捕获 `mm/cm/μm`，统一写 `mm`（μm→0.001 mm），并在 `units_notes` 记录。
* **数值校验**：负值/超大异常 → 降低 `confidence` + 入 `warnings`。
* **去重与并合**：同一区域相同数值/符号的多次识别 → 合并并提升 `confidence`。
* **证据框**：`region` 用像素坐标；表格行尽可能给 `table_row`，便于前端高亮。
* **语言**：`raw` 保留原样（可含英文/符号），`text/value` 给标准化结果（中文优先）。

---

# 五、与主模型的衔接

* 视觉模型**只输出候选事实 JSON**，不做装配/工艺推理。
* 主模型（你已设计）按**来源权重**融合：`BOM(0.9) > 技术要求(0.8) > 视觉要素(0.7)`；一致性+0.1。
* 视觉输出中的 `part_bubble_candidates` 与 `bom_candidates.seq` 由主模型或中间层去做匹配（气泡号 ↔ BOM 序号/代号）。

---

# 六、少量示例片段（和你图纸风格一致）

* 焊缝：`"weld_symbol": {"type":"fillet","leg":8,"continuous":true,"double_side":false}`
* 孔列：`"pattern_hole": {"distances":[100,170,283]}`
* 板厚：`"plate_thickness": {"t":6.00}`
* 技术要求：`"text":"未注尺寸公差按 T/1184-k；焊接完工去毛刺除锈；喷涂前表面处理。"`

---

# 七、对接方式（Augment/服务编排建议）

* 给这个视觉智能体配置**固定 System Prompt**（即本文第 1 节），每页图片各调用一次；
* 将所有页的输出合并为一份大的**候选事实 JSON**（保留 `page_id`）；
* 把合并结果送入你的**主模型**进行融合与推理；
* 全链路保留 `evidence.region/table_row`，支持前端回看与审校。

---

需要我把这份**候选事实 JSON 的 JSON Schema**（`candidate_facts.schema.json`）也写成可校验版本吗？我可以直接给到 `$id`、`$defs`、枚举与正则，这样你用 Pydantic/ajv 一验就过。
